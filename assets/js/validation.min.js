/*
* Validation form with Prototype*
*/
var Validator=Class.create();Validator.prototype={initialize:function(a,b,c,d){"function"==typeof c?(this.options=$H(d),this._test=c):(this.options=$H(c),this._test=function(){return!0}),this.error=b||"Validation failed.",this.className=a},test:function(a,b){return this._test(a,b)&&this.options.all(function(c){return!Validator.methods[c.key]||Validator.methods[c.key](a,b,c.value)})}},Validator.methods={pattern:function(a,b,c){return Validation.get("IsEmpty").test(a)||c.test(a)},minLength:function(a,b,c){return a.length>=c},maxLength:function(a,b,c){return a.length<=c},min:function(a,b,c){return a>=parseFloat(c)},max:function(a,b,c){return a<=parseFloat(c)},notOneOf:function(a,b,c){return $A(c).all(function(b){return a!==b})},oneOf:function(a,b,c){return $A(c).any(function(b){return a===b})},is:function(a,b,c){return a===c},isNot:function(a,b,c){return a!==c},equalToField:function(a,b,c){return a===$F(c)},notEqualToField:function(a,b,c){return a!==$F(c)},include:function(a,b,c){return $A(c).all(function(c){return Validation.get(c).test(a,b)})}};var Validation=Class.create();Validation.prototype={initialize:function(a,b){if(this.options=Object.extend({onSubmit:!0,stopOnFirst:!1,immediate:!1,focusOnError:!0,useTitles:!1,onFormValidate:function(a,b){},onElementValidate:function(a,b){}},b||{}),this.form=$(a),this.options.onSubmit&&Event.observe(this.form,"submit",this.onSubmit.bind(this),!1),this.options.immediate){var c=this.options.useTitles,d=this.options.onElementValidate;Form.getElements(this.form).each(function(a){Event.observe(a,"blur",function(a){Validation.validate(Event.element(a),{useTitle:c,onElementValidate:d})})})}},onSubmit:function(a){this.validate()||Event.stop(a)},validate:function(){var a=!1,b=this.options.useTitles,c=this.options.onElementValidate;return a=this.options.stopOnFirst?Form.getElements(this.form).all(function(a){return Validation.validate(a,{useTitle:b,onElementValidate:c})}):Form.getElements(this.form).collect(function(a){return Validation.validate(a,{useTitle:b,onElementValidate:c})}).all(),!a&&this.options.focusOnError&&Form.getElements(this.form).findAll(function(a){return $(a).hasClassName("validation-failed")}).first().focus(),this.options.onFormValidate(a,this.form),a},reset:function(){Form.getElements(this.form).each(Validation.reset)}},Object.extend(Validation,{validate:function(a,b){b=Object.extend({useTitle:!1,onElementValidate:function(a,b){}},b||{}),a=$(a);var c=a.classNames(),d=c.all(function(c){var d=Validation.test(c,a,b.useTitle);return b.onElementValidate(d,a),d});return d},test:function(a,b,c){var d=Validation.get(a),e="__advice"+a.camelize();try{if(Validation.isVisible(b)&&!d.test($F(b),b)){if(!b[e]){var f=Validation.getAdvice(a,b);if(null===f){var g=c&&b&&b.title?b.title:d.error;switch(f='<div class="validation-advice" id="advice-'+a+"-"+Validation.getElmID(b)+'" style="display:none">'+g+"</div>",b.type.toLowerCase()){case"checkbox":case"radio":var h=b.parentNode;h?new Insertion.Bottom(h,f):new Insertion.After(b,f);break;default:new Insertion.After(b,f)}f=Validation.getAdvice(a,b)}"undefined"==typeof Effect?f.show():new Effect.Appear(f,{duration:1})}return b[e]=!0,b.removeClassName("validation-passed"),b.addClassName("validation-failed"),!1}var f=Validation.getAdvice(a,b);return null!=f&&f.hide(),b[e]="",b.removeClassName("validation-failed"),b.addClassName("validation-passed"),!0}catch(a){throw a}},isVisible:function(a){for(;"BODY"!=a.tagName;){if(!$(a).visible())return!1;a=a.parentNode}return!0},getAdvice:function(a,b){return $("advice-"+a+"-"+Validation.getElmID(b))||$("advice-"+Validation.getElmID(b))},getElmID:function(a){return a.id?a.id:a.name},reset:function(a){a=$(a);var b=a.classNames();b.each(function(b){var c="__advice"+b.camelize();if(a[c]){var d=Validation.getAdvice(b,a);d.hide(),a[c]=""}a.removeClassName("validation-failed"),a.removeClassName("validation-passed")})},add:function(a,b,c,d){var e={};e[a]=new Validator(a,b,c,d),Object.extend(Validation.methods,e)},addAllThese:function(a){var b={};$A(a).each(function(a){b[a[0]]=new Validator(a[0],a[1],a[2],a.length>3?a[3]:{})}),Object.extend(Validation.methods,b)},get:function(a){return Validation.methods[a]?Validation.methods[a]:Validation.methods._LikeNoIDIEverSaw_},methods:{_LikeNoIDIEverSaw_:new Validator("_LikeNoIDIEverSaw_","",{})}}),Validation.add("IsEmpty","",function(a){return null==a||0==a.length}),Validation.addAllThese([["required","This is a required field.",function(a){return!Validation.get("IsEmpty").test(a)}],["validate-number","Please enter a valid number in this field.",function(a){return Validation.get("IsEmpty").test(a)||!isNaN(a)&&!/^\s+$/.test(a)}],["validate-digits","Please use numbers only in this field. please avoid spaces or other characters such as dots or commas.",function(a){return Validation.get("IsEmpty").test(a)||!/[^\d]/.test(a)}],["validate-alpha","Please use letters only (a-z) in this field.",function(a){return Validation.get("IsEmpty").test(a)||/^[a-zA-Z]+$/.test(a)}],["validate-alphanum","Please use only letters (a-z) or numbers (0-9) only in this field. No spaces or other characters are allowed.",function(a){return Validation.get("IsEmpty").test(a)||!/\W/.test(a)}],["validate-date","Please enter a valid date.",function(a){if(Validation.get("IsEmpty").test(a))return!0;var b=/^(\d{2})\/(\d{2})\/(\d{4})$/;if(!b.test(a))return!1;var c=new Date(a);return parseInt(RegExp.$2,10)==1+c.getMonth()&&parseInt(RegExp.$1,10)==c.getDate()&&parseInt(RegExp.$3,10)==c.getFullYear()}],["validate-email","Please enter a valid email address. For example fred@domain.com.",function(a){return Validation.get("IsEmpty").test(a)||/\w{1,}[@][\w\-]{1,}([.]([\w\-]{1,})){1,3}$/.test(a)}],["validate-url","Please enter a valid URL.",function(a){return Validation.get("IsEmpty").test(a)||/^(http|https|ftp):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i.test(a)}],["validate-date-au","Please use this date format: dd/mm/yyyy. For example 17/03/2006 for the 17th of March, 2006.",function(a){if(Validation.get("IsEmpty").test(a))return!0;var b=/^(\d{2})\/(\d{2})\/(\d{4})$/;if(!b.test(a))return!1;var c=new Date(a.replace(b,"$2/$1/$3"));return parseInt(RegExp.$2,10)==1+c.getMonth()&&parseInt(RegExp.$1,10)==c.getDate()&&parseInt(RegExp.$3,10)==c.getFullYear()}],["validate-currency-dollar","Please enter a valid $ amount. For example $100.00 .",function(a){return Validation.get("IsEmpty").test(a)||/^\$?\-?([1-9]{1}[0-9]{0,2}(\,[0-9]{3})*(\.[0-9]{0,2})?|[1-9]{1}\d*(\.[0-9]{0,2})?|0(\.[0-9]{0,2})?|(\.[0-9]{1,2})?)$/.test(a)}],["validate-selection","Please make a selection",function(a,b){return b.options?b.selectedIndex>0:!Validation.get("IsEmpty").test(a)}],["validate-one-required","Please select one of the above options.",function(a,b){var c=b.parentNode,d=c.getElementsByTagName("INPUT");return $A(d).any(function(a){return $F(a)})}]]);
